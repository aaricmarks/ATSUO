gsap.registerPlugin(ScrollTrigger);

document.addEventListener('DOMContentLoaded', () => {
    const sections = document.querySelectorAll('.image-section');
    const progressBar = document.querySelector('.progress-bar');
    
    // Set up the first image as active
    sections[0].querySelector('.image-wrapper').classList.add('active');

    // Calculate total scroll height
    const totalHeight = (sections.length - 1) * window.innerHeight;
    
    // Update progress bar
    function updateProgress() {
        const scrollPosition = window.pageYOffset;
        const progress = (scrollPosition / totalHeight) * 100;
        progressBar.style.width = `${Math.min(100, progress)}%`;
    }

    // Handle scroll events
    window.addEventListener('scroll', () => {
        updateProgress();
        
        sections.forEach((section, index) => {
            const rect = section.getBoundingClientRect();
            const wrapper = section.querySelector('.image-wrapper');
            
            // Calculate when the section is in view
            if (rect.top < window.innerHeight * 0.5 && rect.bottom > window.innerHeight * 0.5) {
                wrapper.classList.add('active');
                
                // Create horizontal movement
                gsap.to(wrapper, {
                    x: window.innerWidth * 0.1 * (rect.top / window.innerHeight),
                    duration: 0.5,
                    ease: "power1.out"
                });
            } else {
                wrapper.classList.remove('active');
            }
        });
    });

    // Set up ScrollTrigger for each section
    sections.forEach((section, index) => {
        const wrapper = section.querySelector('.image-wrapper');
        
        ScrollTrigger.create({
            trigger: section,
            start: "top center",
            end: "bottom center",
            onEnter: () => {
                wrapper.classList.add('active');
            },
            onLeave: () => {
                wrapper.classList.remove('active');
            },
            onEnterBack: () => {
                wrapper.classList.add('active');
            },
            onLeaveBack: () => {
                wrapper.classList.remove('active');
            }
        });
    });
});

// Smooth scroll behavior
document.documentElement.style.scrollBehavior = 'smooth';
